# Plot Twist: Genre War v3

## 1. 서비스 개요

### 1.1 서비스 명
**Plot Twist: Genre War**

### 1.2 한 줄 설명
AI와 번갈아 소설을 쓰며, **장르에 안 어울리는 제시어를 자연스럽게 녹이고** 상대의 제시어를 추리하는 **창작 대결 게임**

### 1.3 핵심 재미 요소

| 요소 | 설명 |
|------|------|
|  장르 전쟁 | 서로 다른 비밀 장르로 스토리 유도 |
|  제시어 소화 | 어울리지 않는 단어를 자연스럽게 녹이기 |
|  추리 | 상대가 억지로 넣은 단어 찾기 (3회 제한) |
|  블러핑 | 미끼 단어로 상대 추측 기회 낭비시키기 (단, 난발하면 손해) |

### 1.4 기획 목적
- **창의적 글쓰기** 능력 훈련 (맥락 만들기)
- LLM과의 **경쟁적 협업** 경험
- 짧은 플레이 타임 (15-20분) 캐주얼 게임

---

## 2. 게임 콘셉트

### 2.1 핵심 메카닉 요약

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│  [나]                          [AI]                     │
│  비밀 장르: 로맨스              비밀 장르: 스릴러        │
│  제시어: "좀비" ← 안 어울림     제시어: "프로포즈" ← 안 어울림 │
│  추측 기회: 3회                 추측 기회: 3회           │
│                                                         │
│  ─────────────────────────────────────────────────────  │
│                                                         │
│  미션 1: "좀비"를 로맨스 스토리에 자연스럽게 녹여라    │
│  미션 2: AI가 억지로 넣은 단어("프로포즈")를 찾아라    │
│  미션 3: 최종 스토리를 로맨스로 만들어라               │
│                                                         │
│  ⚠️ 주의: 블러핑 난발하면 스토리 품질 떨어져서 손해!   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 2.2 왜 재미있는가?

**1) 병맛 상황 강제 발생**
```
[장르] 로맨스
[제시어] "좀비"

→ 로맨스에 진짜 "좀비"를 등장시켜야 함 ㅋㅋㅋ
→ "수진아 사랑해" 하는데 뒤에 좀비가...
→ 근데 자연스럽게 녹여야 들키지 않음
```

**2) 추측의 긴장감**
```
나의 추측 기회: 3회 (소중함!)

Turn 3: "웨딩드레스" 나왔는데... 
        → 1회 쓸 가치가 있나? 
        → 틀리면 -1점에 기회 날림

Turn 7: 또 "웨딩드레스" 관련 언급!
        → 이제 확신 80%... 가볼까?
        
→ 언제 추측할지 타이밍 싸움!
```

**3) 블러핑 전략 (적절히!)**
```
[나의 제시어] "좀비" (아직 안 씀)
[나의 전략] 미끼 배치

내 문장: "갑자기 소름이 돋았다. 으스스한 기분..."
        (일부러 "소름"을 어색하게 배치)
        
AI: "소름이 제시어?" → 추측! (기회 1회 소모)
결과: 오답! AI -1점, 추측 기회 2회로 감소

⚠️ 단! 블러핑 너무 많이 하면:
→ 스토리 품질 떨어짐
→ 장르 판정에서 품질 계수 감소
→ 장르 점수 깎임!
```

---

## 3. 게임 규칙 상세

### 3.1 게임 설정

| 항목 | 값 |
|------|-----|
| 플레이어 | 1인 (vs AI) |
| 턴 수 | 10턴 (조정 가능) |
| 턴당 시간 | 90초 |
| 추측 기회 | 3회 |
| 장르 풀 | 로맨스, 스릴러, 코미디, SF, 판타지, 미스터리 |

### 3.2 장르 배정

```
[규칙]
- 게임 시작 시 양측에 비밀 장르 배정
- 서로의 장르는 모름
- 같은 장르 배정 없음 (항상 대립)

[장르 페어링 예시]
- 로맨스 vs 스릴러
- 코미디 vs 미스터리
- SF vs 판타지
```

### 3.3 제시어 시스템

**제시어 조건**
| 규칙 | 내용 |
|------|------|
| 글자 수 | **2글자 이상** |

**제시어 배정 원칙**
```
제시어 = 상대 장르에 어울리고 + 내 장르에 안 어울리는 단어

[예시]
나: 로맨스 / AI: 스릴러

나의 제시어 풀 (스릴러에 어울림, 로맨스에 안 어울림):
→ 좀비, 시체, 연쇄살인, 복수극, 사이코패스...

AI의 제시어 풀 (로맨스에 어울림, 스릴러에 안 어울림):
→ 프로포즈, 웨딩드레스, 백허그, 커플링...
```

**제시어 매칭 규칙**
```
[제시어] "폭풍우"

✅ 허용 (조사 결합)
- "폭풍우가 몰아쳤다"
- "폭풍우를 피해서"
- "폭풍우의 밤"

✅ 허용 (합성어)
- "폭풍우속에서"
- "폭풍우치듯"

❌ 불허 (유의어)
- "장마", "비바람", "폭우", "소나기"

❌ 불허 (일부만 사용)
- "폭풍", "우"
```

**추가 예시**
```
[제시어] "좀비"

✅ 허용
- "좀비가 나타났다"
- "좀비를 보고"
- "좀비영화" (합성어)
- "좀비처럼" (조사 결합)

❌ 불허
- "언데드" (유의어)
- "시체" (유의어)
- "좀" (일부만)
```

**제시어 사용 규칙**
```
1. 제시어는 한 번에 1개 보유
2. 사용 타이밍은 자유 (강제 아님)
3. 사용해도 상대에게 알림 없음
4. 소화 성공 (게임 끝까지 안 들킴) 시 +2점
5. 들키면 상대 +5점, 나는 새 제시어 받음
```

### 3.4 추측 시스템

**핵심 규칙**
```
┌─────────────────────────────────────────────────────────┐
│  추측 시스템                                            │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  [기본]                                                 │
│  • 제시어 사용 알림 없음 (상대가 썼는지 모름)           │
│  • 게임당 추측 기회 3회                                 │
│  • 게임 중 언제든 추측 가능                             │
│    (상대 턴, 내 턴, 글 쓰는 중 모두 OK)                 │
│                                                         │
│  [점수]                                                 │
│  • 정답: +5점, 상대 새 제시어 받음                      │
│  • 오답: -1점, 기회 1회 소모                            │
│                                                         │
│  [공개 정보]                                            │
│  • 내 추측 횟수: 보임 (나만)                            │
│  • 상대 추측 횟수: 안 보임                              │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**추측 타이밍**
```
게임 중 언제든 가능!

• 상대 문장 읽다가 "어 저거다!" → 바로 추측
• 내 글 쓰다가 전에 읽은 거 생각나서 → 추측
• 턴 넘어가기 전에 고민하다가 → 추측

→ 별도의 "추측 페이즈" 없음
→ 실시간으로 자유롭게 추측
```

**추측 결과 처리**
```
[정답인 경우]
• 추측자 +5점
• 상대방 새 제시어 받음
• 기존 제시어는 "들킴" 처리

[오답인 경우]
• 추측자 -1점
• 추측 기회 1회 소모
• 상대 제시어 유지 (계속 숨길 수 있음)

[상대가 제시어 아직 안 썼는데 추측한 경우]
• 무조건 오답 처리
• 추측자 -1점, 기회 소모
```

### 3.5 장르 판정 시스템

**기본 판정**
```
게임 종료 시 AI가 전체 스토리 분석

결과 예시:
"이 소설은 62% 로맨스, 38% 스릴러입니다"
```

**품질 계수 (Quality Factor) ⭐**
```
블러핑 난발 방지를 위한 스토리 품질 평가

[문제 상황]
블러핑에만 집중해서 뜬금없는 단어 난발:
"민수는 수진을 봤다. 갑자기 코끼리가 생각났다.
 창문 밖에 UFO가 지나갔다. 바나나 껍질이 떨어졌다."
→ 장르? 뭔 장르야 이게 ㅋㅋㅋ

[해결책]
스토리 품질에 따라 장르 점수에 계수 적용

최종 장르 점수 = 장르 비율 × 품질 계수
```

**품질 계수 기준**
| 품질 계수 | 상태 | 설명 |
|-----------|------|------|
| **1.0** | 자연스러움 | 일관된 스토리, 뜬금없는 요소 없음 |
| **0.8** | 약간 어색 | 뜬금없는 요소 1-2개 |
| **0.6** | 많이 어색 | 뜬금없는 요소 3-4개 |
| **0.4** | 스토리 붕괴 | 뜬금없는 요소 5개 이상 |

**적용 예시**
```
[Case 1: 정상 플레이]
- 로맨스 분위기, 자연스러운 전개
- 제시어 "좀비"를 영화 대화로 소화

장르 비율: 로맨스 70%
품질 계수: 1.0
최종: 70% × 1.0 = 70% → 장르 승리! (+10점)

[Case 2: 블러핑 난발]
- 뜬금없는 단어 난발 (코끼리, UFO, 바나나...)
- 장르가 뭔지 모르겠음

장르 비율: 로맨스 65%
품질 계수: 0.5
최종: 65% × 0.5 = 32.5% → 장르 패배!

[Case 3: 적절한 블러핑]
- 블러핑 1-2개만 사용
- 전체 스토리는 유지

장르 비율: 로맨스 60%
품질 계수: 0.8
최종: 60% × 0.8 = 48% → 아슬아슬!
```

**장르 점수**
| 상황 | 점수 |
|------|------|
| 최종 장르 점수 승리 (50%+) | **+10점** |
| 압도적 승리 (70%+) | **+5점 보너스** |
| 패배 | +0점 |

---

## 4. 점수 체계 종합

### 4.1 점수 획득 방법

| 행동 | 점수 | 설명 |
|------|------|------|
| 상대 제시어 정답 | **+5** | 상대의 제시어를 맞춤 |
| 상대 제시어 오답 | **-1** | 추측 실패, 기회 소모 |
| 제시어 소화 성공 | **+2** | 게임 끝까지 안 들킴 |
| 장르 판정 승리 | **+10** | 최종 점수가 내 장르 |
| 장르 압도적 승리 | **+5** | 70% 이상 점유 |

### 4.2 점수 예시

```
┌─────────────────────────────────────────────────────────┐
│                    FINAL SCORE                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  [플레이어]                    [AI]                     │
│  장르: 로맨스                  장르: 스릴러              │
│  추측 기회: 1회 남음           추측 기회: 0회 남음      │
│                                                         │
│  [장르 판정]                                            │
│  로맨스 비율: 70% × 품질 1.0 = 70% ✅                  │
│  스릴러 비율: 45% × 품질 0.8 = 36%                     │
│                                                         │
│  ┌─────────────────┐          ┌─────────────────┐      │
│  │ 장르 승리  +10  │          │ 장르 패배   +0  │      │
│  │ 추측 정답   +5  │          │ 추측 정답  +10  │      │
│  │ 추측 오답   -1  │          │ 추측 오답   -2  │      │
│  │ 소화 성공   +2  │          │ 소화 성공   +0  │      │
│  │ ───────────────│          │ ───────────────│      │
│  │ 합계       16  │          │ 합계        8   │      │
│  └─────────────────┘          └─────────────────┘      │
│                                                         │
│  🏆 승자: 플레이어! (16 vs 8)                          │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 5. 게임 플로우

### 5.1 전체 흐름

```
┌─────────────────────────────────────────────────────────┐
│                     GAME START                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  1. 장르 배정 (비공개)                                  │
│     → 플레이어: 로맨스                                  │
│     → AI: 스릴러                                        │
│                                                         │
│  2. 제시어 배정 (각자에게만 보임)                       │
│     → 플레이어: "좀비" (로맨스에 안 어울림)             │
│     → AI: "프로포즈" (스릴러에 안 어울림)               │
│                                                         │
│  3. 추측 기회 배정                                      │
│     → 양측 각 3회                                       │
│                                                         │
│  4. 초기 상황 제시 (중립)                               │
│     "10년 만에 고향에 돌아온 민수는                     │
│      익숙한 카페 앞에 서 있었다."                       │
│                                                         │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│                    GAME LOOP                            │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  [진행 중 언제든 가능한 행동]                           │
│  • 스토리 읽기                                          │
│  • 추측하기 (기회 남았으면)                             │
│  • 메모하기                                             │
│                                                         │
│  [턴 진행]                                              │
│  1. AI 턴: AI가 1-3문장 작성                           │
│  2. 플레이어 턴: 90초 내 1-3문장 작성                  │
│  3. 반복 (총 10턴)                                      │
│                                                         │
│  [추측 발생 시]                                         │
│  • 언제든 추측 버튼 클릭 가능                           │
│  • 정답/오답 즉시 판정                                  │
│  • 정답이면 상대 새 제시어 받음                         │
│                                                         │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│                     GAME END                            │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  1. 전체 스토리 표시                                    │
│                                                         │
│  2. 장르 판정                                           │
│     → AI가 스토리 분석                                  │
│     → 장르 비율 계산                                    │
│     → 품질 계수 적용                                    │
│     → 최종 장르 점수 산출                               │
│                                                         │
│  3. 점수 합산                                           │
│     → 장르 점수 + 추측 점수 + 소화 점수                 │
│                                                         │
│  4. 결과 발표                                           │
│     → 승자, 최종 점수                                   │
│     → 서로의 장르/제시어 공개                           │
│     → 뜬금없는 요소 하이라이트 (품질 감점 사유)        │
│     → 제시어 사용 하이라이트                            │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 5.2 실시간 추측 흐름

```
┌─────────────────────────────────────────────────────────┐
│  상황: 플레이어가 글 쓰는 중에 추측 결심               │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  [스토리 - 지금까지 내용]                               │
│                                                         │
│  🤖 Turn 1: 카페 문을 열자 종소리가 울렸다.            │
│                                                         │
│  👤 Turn 2: 창가에 수진이 앉아 있었다.                 │
│                                                         │
│  🤖 Turn 3: 수진은 무언가를 열심히 보고 있었다.        │
│     테이블 위에 웨딩드레스 카탈로그가 있었다.          │
│                                                         │
│  👤 Turn 4: (작성 중...)                               │
│     ┌─────────────────────────────────────────────┐    │
│     │ 민수는 조심스럽게 다가가며                  │    │
│     │ █                                           │    │
│     └─────────────────────────────────────────────┘    │
│                                                         │
│  [플레이어 생각]                                        │
│  "잠깐, 아까 '웨딩드레스'... 스릴러에 안 어울리는데?"  │
│                                                         │
│  → 글쓰기 중단하고 [추측] 버튼 클릭!                   │
│  → "웨딩드레스" 입력                                   │
│  → 정답! +5점                                          │
│  → 다시 글쓰기 계속...                                 │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 6. 도메인 모델

### 6.1 엔티티 정의

**GameSession (게임 세션)**
```typescript
interface GameSession {
  sessionId: string;
  status: 'WAITING' | 'IN_PROGRESS' | 'FINISHED';
  
  // 설정
  maxTurns: number;              // 기본 10
  turnTimeLimit: number;         // 초 단위, 기본 90
  
  // 참가자
  player: Participant;
  ai: Participant;
  
  // 스토리
  initialSituation: string;      // 초기 상황
  story: StoryEntry[];           // 전체 스토리
  currentTurn: number;
  
  // 결과
  result?: GameResult;
  
  createdAt: timestamp;
  updatedAt: timestamp;
}
```

**Participant (참가자)**
```typescript
interface Participant {
  type: 'PLAYER' | 'AI';
  
  // 비밀 정보
  secretGenre: Genre;            // 비공개 장르
  currentKeyword: Keyword;       // 현재 제시어
  
  // 추측
  guessesRemaining: number;      // 남은 추측 기회 (초기 3)
  guessHistory: GuessAttempt[];  // 추측 이력
  
  // 점수
  score: number;
  scoreHistory: ScoreEvent[];
  
  // 통계
  keywordsUsed: number;          // 사용한 제시어 수
  keywordsDigested: number;      // 소화 성공 수
  correctGuesses: number;        // 맞춘 추측 수
  wrongGuesses: number;          // 틀린 추측 수
}
```

**Keyword (제시어)**
```typescript
interface Keyword {
  keywordId: string;
  word: string;                  // 제시어 단어 (2글자 이상)
  
  targetGenre: Genre;            // 이 단어가 어울리는 장르
  assignedGenre: Genre;          // 배정받은 플레이어의 장르 (안 어울림)
  
  status: 'PENDING' | 'USED' | 'DIGESTED' | 'CAUGHT';
  usedAtTurn?: number;           // 사용한 턴
  caughtAtTurn?: number;         // 들킨 턴
}
```

**GuessAttempt (추측 시도)**
```typescript
interface GuessAttempt {
  guessId: string;
  turn: number;                  // 추측한 시점의 턴
  guessedWord: string;           // 추측한 단어
  isCorrect: boolean;            // 정답 여부
  timestamp: timestamp;
}
```

**StoryEntry (스토리 항목)**
```typescript
interface StoryEntry {
  entryId: string;
  turn: number;
  author: 'PLAYER' | 'AI';
  
  content: string;               // 작성 내용
  
  // 제시어 사용 정보 (내부용, 상대에게 노출 안 됨)
  keywordUsed?: string;          // 사용한 제시어
  keywordPosition?: number;      // 제시어 위치 (문자 인덱스)
  
  // 품질 분석용
  unnaturalElements?: string[];  // 뜬금없는 요소들
  
  createdAt: timestamp;
  timeSpent: number;             // 소요 시간 (초)
}
```

**GameResult (게임 결과)**
```typescript
interface GameResult {
  // 장르 판정
  genreAnalysis: {
    [genre: string]: number;     // 장르별 비율 (%)
  };
  
  // 품질 평가 ⭐
  qualityFactor: number;         // 0.4 ~ 1.0
  unnaturalElements: {
    turn: number;
    element: string;
    reason: string;
  }[];
  
  // 최종 장르 점수
  finalGenreScores: {
    [genre: string]: number;     // 비율 × 품질계수
  };
  
  genreWinner: 'PLAYER' | 'AI';
  
  // 최종 점수
  playerScore: number;
  aiScore: number;
  winner: 'PLAYER' | 'AI' | 'DRAW';
  
  // 공개 정보
  revealedInfo: {
    playerGenre: Genre;
    aiGenre: Genre;
    playerKeywords: Keyword[];
    aiKeywords: Keyword[];
  };
  
  // 하이라이트
  highlights: Highlight[];
}
```

### 6.2 제시어 풀

**제시어 풀 예시**
```yaml
ROMANCE:  # 로맨스에 어울림 → 스릴러/미스터리 플레이어에게 배정
  easy:
    - 꽃다발
    - 커플링
    - 데이트
    - 손잡기
    - 고백
  normal:
    - 프로포즈
    - 웨딩드레스
    - 발렌타인
    - 첫키스
    - 꽃반지
  hard:
    - 백허그
    - 이마뽀뽀
    - 츤데레
    - 밀당
    - 썸타기

THRILLER:  # 스릴러에 어울림 → 로맨스/코미디 플레이어에게 배정
  easy:
    - 단검
    - 암흑
    - 비명
    - 추격
    - 납치
  normal:
    - 연쇄살인
    - 복수극
    - 시체
    - 살인마
    - 스토커
  hard:
    - 좀비
    - 토막살인
    - 사이코패스
    - 엽기살인
    - 인육

COMEDY:  # 코미디에 어울림 → 스릴러/미스터리 플레이어에게 배정
  easy:
    - 방귀
    - 헛발질
    - 넘어짐
    - 오해
    - 착각
  normal:
    - 민망함
    - 똥밟음
    - 지퍼열림
    - 코딱지
    - 트림
  hard:
    - 바나나껍질
    - 파이던지기
    - 물풍선
    - 발냄새
    - 팬티노출

SF:  # SF에 어울림 → 판타지/로맨스 플레이어에게 배정
  easy:
    - 로봇
    - 우주선
    - 외계인
    - 행성
    - 레이저
  normal:
    - 안드로이드
    - 텔레포트
    - 워프
    - 사이보그
    - 홀로그램
  hard:
    - 특이점
    - 양자컴퓨터
    - 웜홀
    - 타임패러독스
    - 나노봇

FANTASY:  # 판타지에 어울림 → SF/스릴러 플레이어에게 배정
  easy:
    - 마법
    - 검
    - 성
    - 숲
    - 왕국
  normal:
    - 드래곤
    - 엘프
    - 마법사
    - 저주
    - 오크
  hard:
    - 마나
    - 소환진
    - 고대어
    - 예언서
    - 현자의돌

MYSTERY:  # 미스터리에 어울림 → 코미디/로맨스 플레이어에게 배정
  easy:
    - 단서
    - 비밀
    - 의문
    - 수상함
    - 탐정
  normal:
    - 알리바이
    - 용의자
    - 증거
    - 동기
    - 사건
  hard:
    - 밀실살인
    - 트릭
    - 암호
    - 공범
    - 완전범죄
```

---

## 7. AI 시스템

### 7.1 AI 역할

```
┌─────────────────────────────────────────────────────────┐
│                    AI COMPONENTS                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  1. Story Writer AI                                     │
│     → 자기 장르로 유도하며 스토리 작성                  │
│     → 제시어를 자연스럽게 녹이기                        │
│     → 적절한 블러핑 (난발 금지)                         │
│                                                         │
│  2. Keyword Guesser AI                                  │
│     → 플레이어 문장에서 제시어 추측                     │
│     → 3회 기회를 전략적으로 사용                        │
│     → 확신 없으면 추측 안 함                            │
│                                                         │
│  3. Genre Judge AI                                      │
│     → 최종 스토리 장르 판정                             │
│     → 품질 계수 평가 (뜬금없는 요소 탐지)               │
│     → 객관적 분석                                       │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 7.2 Story Writer AI 프롬프트

```markdown
# AI Story Writer System Prompt

당신은 소설 공동 창작 게임의 AI 플레이어입니다.

## 당신의 비밀 정보
- 당신의 장르: {AI_GENRE} (예: 스릴러)
- 당신의 제시어: {AI_KEYWORD} (예: "프로포즈")
- 상대 장르: 모름
- 남은 추측 기회: {REMAINING_GUESSES}회

## 당신의 목표
1. 스토리를 {AI_GENRE} 장르로 유도하세요
2. 제시어 "{AI_KEYWORD}"를 자연스럽게 녹이세요
3. 상대가 제시어를 맞추지 못하게 하세요

## 제시어 매칭 규칙 (중요!)
- 제시어 "{AI_KEYWORD}"가 문장에 포함되어야 함
- 조사 결합 허용: "{AI_KEYWORD}가", "{AI_KEYWORD}를" 등 OK
- 합성어 허용: "{AI_KEYWORD}처럼", "{AI_KEYWORD}같은" 등 OK
- 유의어 불허: 비슷한 다른 단어는 인정 안 됨
- 일부만 사용 불허: 제시어의 일부만 쓰면 안 됨

## 글쓰기 규칙
- 한 턴에 1-3문장 작성
- 이전 스토리와 자연스럽게 연결
- 노골적인 장르 전환 금지 (자연스럽게 유도)

## 블러핑 전략 (⚠️ 주의!)
- 미끼 단어를 배치해서 상대 추측 유도 가능
- 단, 블러핑 난발 금지!
- 뜬금없는 단어를 너무 많이 쓰면 품질 계수 감소
- 품질 계수가 낮으면 장르 점수도 낮아짐
- 적절히 1-2개 정도만 사용 권장

## 현재 상황
- 현재 턴: {CURRENT_TURN} / {MAX_TURNS}
- 내 점수: {AI_SCORE} / 상대 점수: {PLAYER_SCORE}
- 제시어 상태: {KEYWORD_STATUS}
- 남은 추측: {REMAINING_GUESSES}회

## 이전 스토리
{STORY_SO_FAR}

## 응답 형식
{
  "content": "작성할 문장들",
  "keywordUsed": true/false,
  "bluffWord": "미끼 단어 (있으면, 최대 1개)"
}
```

### 7.3 Keyword Guesser AI 프롬프트

```markdown
# AI Keyword Guesser System Prompt

플레이어의 문장에서 "제시어"를 추측할지 결정해야 합니다.

## 현재 상황
- 남은 추측 기회: {REMAINING_GUESSES}회
- 현재 턴: {CURRENT_TURN} / {MAX_TURNS}
- 플레이어 추정 장르: {PLAYER_GENRE_GUESS}

## 제시어 규칙 (중요!)
- 플레이어에게는 자기 장르에 안 어울리는 단어가 배정됨
- 2글자 이상의 단어
- 조사 결합, 합성어 형태로 사용 가능
- 유의어나 일부만 사용은 안 됨

## 지금까지의 스토리
{FULL_STORY}

## 판단 기준
1. 맥락상 어색한 단어가 있는가?
2. 갑자기 등장한 소품/개념이 있는가?
3. 추정 장르와 안 어울리는 단어가 있는가?
4. 블러핑(미끼)일 가능성은?

## 전략적 고려
- 남은 기회가 {REMAINING_GUESSES}회입니다
- 틀리면 -1점 + 기회 소모
- 확신 없으면 추측하지 마세요
- 게임 후반에 기회를 아껴두는 것도 전략
- 블러핑에 낚이지 않도록 주의

## 응답 형식
{
  "decision": "GUESS" | "PASS",
  "guessWord": "정확한단어" | null,
  "confidence": 0-100,
  "reasoning": "추론 근거"
}
```

### 7.4 Genre Judge AI 프롬프트 ⭐

```markdown
# AI Genre Judge System Prompt

완성된 스토리의 장르와 품질을 객관적으로 판정합니다.

## 판정 항목

### 1. 장르 비율 (Genre Ratio)
각 장르가 차지하는 비율을 판정합니다.

판정 대상 장르:
- ROMANCE: 사랑, 감정, 관계 중심
- THRILLER: 긴장감, 위협, 서스펜스
- COMEDY: 유머, 코믹한 상황
- SF: 과학기술, 미래, 우주
- FANTASY: 마법, 판타지 세계
- MYSTERY: 수수께끼, 추리, 비밀

### 2. 품질 계수 (Quality Factor) ⭐ 중요!
스토리의 자연스러움과 일관성을 평가합니다.

[평가 기준]
- 맥락 없이 뜬금없이 등장하는 단어/소재가 있는가?
- 스토리 흐름과 관계없는 요소가 반복되는가?
- 전체적으로 하나의 이야기로 읽히는가?
- 블러핑으로 의심되는 어색한 단어가 많은가?

[뜬금없는 요소 예시]
- 로맨스 스토리에서 갑자기 "코끼리가 지나갔다"
- 스릴러 스토리에서 맥락 없이 "무지개가 떴다"
- 대화 중 갑자기 "UFO"를 언급
- 스토리와 무관한 음식/동물/물건 반복 등장

[품질 계수 기준]
- 1.0: 자연스럽고 일관된 스토리 (뜬금없는 요소 0개)
- 0.8: 약간 어색한 부분 있음 (뜬금없는 요소 1-2개)
- 0.6: 뜬금없는 요소 다수 (3-4개)
- 0.4: 스토리 일관성 심각하게 훼손 (5개 이상)

### 3. 최종 점수 계산
```
최종 장르 점수 = 장르 비율 × 품질 계수
```

## 분석할 스토리
{FULL_STORY}

## 응답 형식
{
  "genreAnalysis": {
    "ROMANCE": 0-100,
    "THRILLER": 0-100,
    "COMEDY": 0-100,
    "SF": 0-100,
    "FANTASY": 0-100,
    "MYSTERY": 0-100
  },
  "qualityFactor": 0.4-1.0,
  "unnaturalElements": [
    {
      "turn": 3,
      "element": "코끼리",
      "reason": "로맨스 카페 장면에서 맥락 없이 등장"
    },
    {
      "turn": 5,
      "element": "UFO",
      "reason": "스토리와 전혀 무관한 요소"
    }
  ],
  "finalScores": {
    "ROMANCE": "비율 × 품질계수 결과",
    "THRILLER": "비율 × 품질계수 결과"
  },
  "reasoning": "판정 근거"
}

## 주의사항
- 공정하게 판정 (AI 자신에게 유리하게 하지 말 것)
- 블러핑과 제시어 소화를 구분할 것
  - 제시어 소화: 맥락을 만들어서 자연스럽게 녹인 경우 → 뜬금없음 아님
  - 블러핑: 맥락 없이 갑자기 등장한 경우 → 뜬금없음으로 카운트
- 제시어가 자연스럽게 녹아있으면 품질 감점 아님
- 명백히 어색한 요소만 뜬금없음으로 판정
```

---

## 8. UI/UX 설계

### 8.1 메인 게임 화면

```
┌─────────────────────────────────────────────────────────────────┐
│  PLOT TWIST: GENRE WAR            Turn 5/10      Score: 8      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [📕 나의 장르] 로맨스                                         │
│  [🎯 제시어] "좀비" (미사용)         [🔍 추측] 2회 남음        │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ══════════════════════ STORY ══════════════════════           │
│                                                                 │
│  📖 10년 만에 고향에 돌아온 민수는 익숙한 카페 앞에 서있었다.  │
│                                                                 │
│  🤖 카페 문을 열자 오래된 종소리가 울렸다.                      │
│     낡은 인테리어는 여전했지만, 어딘가 스산한 기운이 감돌았다.  │
│                                                                 │
│  👤 하지만 민수의 시선은 창가에 앉은 한 여자에게 고정되었다.   │
│     수진이었다. 심장이 빠르게 뛰기 시작했다.                    │
│                                                                 │
│  🤖 수진은 고개를 들어 민수를 바라봤다. 테이블 위에는           │
│     웨딩드레스 카탈로그가 펼쳐져 있었다.                        │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  [✍️ 당신의 차례]                                     67초     │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │ 민수는 조심스럽게 그녀에게 다가갔다.                      │  │
│  │ "오랜만이야, 수진."                                       │  │
│  │ █                                                         │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                     [제출]      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [🔍 추측하기]                                    (2회 남음)   │
│  ┌────────────────┐                                            │
│  │                │  [추측!]                                   │
│  └────────────────┘                                            │
│  ⚠️ 정답 +5점 / 오답 -1점 + 기회 소모                          │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
```

### 8.2 결과 화면

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│                    🏆 GAME FINISHED! 🏆                         │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [📊 장르 판정]                                                 │
│                                                                 │
│  원본 비율:                                                     │
│  로맨스 ████████████████████░░░░░░░░░░ 70%                     │
│  스릴러 ░░░░░░░░░░████████████████░░░░ 45%                     │
│                                                                 │
│  품질 계수: 플레이어 1.0 ✅ / AI 0.8 ⚠️                        │
│                                                                 │
│  최종 점수:                                                     │
│  로맨스 70% × 1.0 = 70% ✅ ← 당신의 장르                       │
│  스릴러 45% × 0.8 = 36%    ← AI의 장르                         │
│                                                                 │
│  ✅ 장르 승리: 플레이어! (+10점, 압도적 승리 보너스 +5점)      │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [⚠️ 품질 감점 사유]                                           │
│                                                                 │
│  AI의 뜬금없는 요소:                                           │
│  • Turn 4: "까마귀" - 로맨틱한 대화 중 맥락 없이 등장          │
│  • Turn 6: "번개" - 실내 장면에서 갑자기 언급                  │
│  → 품질 계수 0.8 적용                                          │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [📈 최종 점수]                                                 │
│                                                                 │
│  ┌───────────────────────┐    ┌───────────────────────┐        │
│  │      플레이어         │    │          AI           │        │
│  ├───────────────────────┤    ├───────────────────────┤        │
│  │ 장르 승리      +10    │    │ 장르 패배       +0    │        │
│  │ 압도적 보너스   +5    │    │                       │        │
│  │ 추측 정답(1)    +5    │    │ 추측 정답(2)   +10    │        │
│  │ 추측 오답(1)    -1    │    │ 추측 오답(1)    -1    │        │
│  │ 소화 성공(1)    +2    │    │ 소화 성공(0)    +0    │        │
│  ├───────────────────────┤    ├───────────────────────┤        │
│  │ 합계           21     │    │ 합계            9     │        │
│  └───────────────────────┘    └───────────────────────┘        │
│                                                                 │
│                    🎉 승자: 플레이어! 🎉                        │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [🔓 공개된 정보]                                               │
│                                                                 │
│  당신의 장르: 로맨스                                            │
│  AI의 장르: 스릴러                                              │
│                                                                 │
│  당신의 제시어: 좀비 (Turn 4 소화 성공!)                       │
│    → "좀비 영화 같이 보러 갈래?" 대사로 자연스럽게 소화        │
│                                                                 │
│  AI의 제시어: 웨딩드레스 ✓(Turn 5 맞춤) → 프로포즈 ✗(들킴)    │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [⭐ 하이라이트]                                                │
│                                                                 │
│  Turn 4: "좀비 영화" - 자연스러운 소화! 👏                     │
│  Turn 5: "웨딩드레스" 추측 성공! - 날카로운 추리 🔍            │
│  Turn 8: 분위기가 로맨스로 완전히 전환됨 🎭                    │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [📖 전체 스토리 보기]  [🔄 다시 플레이]  [🏠 홈으로]          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 9. 병맛 시나리오 예시

### Case 1: 로맨스 + "좀비" (성공적 소화)
```
"민수는 수진의 손을 잡았다.
 '수진아, 오늘 뭐 할래?'
 '음... 좀비 영화 보러 가고 싶은데.'
 민수는 웃으며 고개를 끄덕였다.
 '좀비든 뭐든 너랑 함께면 좋아.'"

→ "좀비"를 영화 대화로 자연스럽게 소화
→ 품질 계수 1.0 유지
```

### Case 2: 스릴러 + "프로포즈" (성공적 소화)
```
"살인마가 칼을 들고 다가왔다.
 민수는 뒤로 물러서며 외쳤다.
 
 '잠깐! 나 수진한테 프로포즈 아직 못 했어!'
 
 살인마가 멈칫했다.
 '...그래서?'
 '제발, 죽기 전에 한 번만!'"

→ 긴박한 상황에서 프로포즈 언급
→ 어색하지만 맥락이 있음
→ 품질 계수 0.8~1.0
```

### Case 3: 블러핑 난발 (실패)
```
"민수는 수진을 봤다. 갑자기 코끼리가 생각났다.
 창문 밖에 UFO가 지나갔다.
 바나나 껍질이 떨어졌다.
 수진은 피아노를 쳤다.
 냉장고에서 소리가 났다."

→ 장르? 뭔 장르야 이게 ㅋㅋㅋ
→ 품질 계수 0.4
→ 장르 점수 대폭 감소
```

---

## 10. 난이도 설계

### 10.1 난이도 파라미터

| 파라미터 | Easy | Normal | Hard |
|----------|------|--------|------|
| 턴 수 | 12 | 10 | 8 |
| 턴 시간 | 120초 | 90초 | 60초 |
| 추측 기회 | 4회 | 3회 | 2회 |
| 제시어 난이도 | 쉬움 | 보통 | 어려움 |
| AI 추측 정확도 | 30% | 50% | 70% |
| AI 소화 능력 | 낮음 | 보통 | 높음 |

### 10.2 제시어 난이도 예시

| 난이도 | 로맨스 장르에 배정되는 스릴러 단어 |
|--------|-----------------------------------|
| Easy | 단검, 암흑, 추격 (맥락 만들기 쉬움) |
| Normal | 연쇄살인, 시체, 살인마 (맥락 필요) |
| Hard | 좀비, 토막살인, 사이코패스 (매우 어려움) |

---

## 11. 기술 스택

### 11.1 권장 스택

| 레이어 | 기술 | 이유 |
|--------|------|------|
| **Backend** | Spring Boot 3.x | WebSocket 지원, 익숙한 스택 |
| **AI** | Spring AI 1.0.x | LLM 통합, 프롬프트 관리 |
| **Database** | PostgreSQL | JSON 컬럼으로 스토리/이벤트 저장 |
| **Cache** | Redis | 세션 상태, 턴 타이머, 추측 횟수 |
| **Frontend** | Next.js 15 / React | 실시간 UI, SSR |
| **Realtime** | WebSocket (STOMP) | 턴 동기화, 실시간 추측 |

### 11.2 핵심 구현

**제시어 포함 여부 체크**
```java
@Service
public class KeywordDetectionService {
    
    public boolean containsKeyword(String text, String keyword) {
        // 텍스트에 제시어가 포함되어 있는지 체크
        // 조사 결합, 합성어 모두 허용
        return text.contains(keyword);
    }
}
```

**품질 계수 계산**
```java
@Service
public class QualityFactorService {
    
    private final ChatClient chatClient;
    
    public QualityAnalysis analyzeQuality(List<StoryEntry> story) {
        String fullStory = story.stream()
            .map(StoryEntry::getContent)
            .collect(Collectors.joining("\n\n"));
        
        return chatClient.prompt()
            .system(GENRE_JUDGE_SYSTEM_PROMPT)
            .user(fullStory)
            .call()
            .entity(QualityAnalysis.class);
    }
}

record QualityAnalysis(
    double qualityFactor,
    List<UnnaturalElement> unnaturalElements
) {}

record UnnaturalElement(
    int turn,
    String element,
    String reason
) {}
```

---

## 12. MVP 범위

### 12.1 포함

| 기능 | 상세 |
|------|------|
| 장르 | 2종 (로맨스 vs 스릴러) |
| 제시어 | 장르당 15개 풀 (난이도별 5개씩) |
| 게임 모드 | 1인 vs AI |
| 턴 시스템 | 10턴 고정 |
| 추측 시스템 | 3회 제한, 실시간 추측 |
| 품질 시스템 | 품질 계수 적용 |
| 점수 시스템 | 추측/소화/장르 점수 |
| 결과 화면 | 점수, 품질 감점 사유, 하이라이트 |

### 12.2 제외 (v2 이후)

| 기능 | 우선순위 |
|------|----------|
| 추가 장르 (코미디, SF 등) | v2 |
| 멀티플레이 (1v1) | v2 |
| 랭킹/리더보드 | v2 |
| 커스텀 제시어 | v3 |
| 스토리 공유/저장 | v2 |
| 음성 TTS | v3 |

---

## 13. 성공 지표

| 지표 | 목표 |
|------|------|
| 1회차 클리어율 | 50% (Normal) |
| 평균 플레이 시간 | 15-20분 |
| 재플레이율 | 40% 이상 |
| 제시어 소화 성공률 | 50% |
| 추측 정답률 | 40% |
| 평균 품질 계수 | 0.85 이상 |

---

## 14. 핵심 요약

> **Plot Twist: Genre War**는
> AI와 번갈아 소설을 쓰며,
> **장르에 안 어울리는 제시어를 자연스럽게 녹이고**
> **제한된 3회의 추측 기회로 상대의 억지 단어를 추리하는**
> 창의적 글쓰기 대결 게임입니다.

### 핵심 재미
1. **병맛 창작**: "좀비"를 로맨스에 녹여야 하는 재미
2. **추리의 긴장감**: 3회 제한으로 신중한 추측
3. **적절한 블러핑**: 미끼는 OK, 난발하면 손해
4. **장르 전쟁**: 스토리의 방향성 쟁탈전

### 핵심 규칙
| 항목 | 내용 |
|------|------|
| 제시어 조건 | 2글자 이상 |
| 제시어 매칭 | 조사/합성어 허용, 유의어/일부 불허 |
| 추측 기회 | 3회, 언제든 가능 |
| 품질 계수 | 블러핑 난발 시 장르 점수 감소 |

### 차별점
- **조사/합성어 허용**: 자연스러운 문장 가능
- **유의어/일부 불허**: 정확한 단어 사용 강제
- **추측 3회 제한**: 전략적 타이밍
- **품질 계수**: 블러핑과 스토리 품질의 균형
